{% extends 'base.html' %}
{% load static %}
{% block title %}
天天生鲜-购物车
{% endblock title %}
{% block topfiles %}

{% endblock topfiles %}
{% block body %}
<div class="search_bar clearfix">
	<a href="{% url 'goods:index' %}" class="logo fl"><img src="{% static 'images/logo.png'%} "></a>
	<div class="sub_page_name fl">|&nbsp;&nbsp;&nbsp;&nbsp;购物车</div>
	<div class="search_con fr">
		<form method="GET" action="/search">
			<input type="text" class="input_text fl" name="q" placeholder="搜索商品">
			<input type="submit" class="input_btn fr" name="" value="搜索">
		</form>
	</div>
</div>

<div class="total_count">全部商品<em>{{total_count}}</em>件</div>
<ul class="cart_list_th clearfix">
	<li class="col01">商品名称</li>
	<li class="col02">商品单位</li>
	<li class="col03">商品价格</li>
	<li class="col04">数量</li>
	<li class="col05">小计</li>
	<li class="col06">操作</li>
</ul>
{% for sku in skus %}
<ul class="cart_list_td clearfix">
	<li class="col01"><input type="checkbox" name="" checked=''></li>
	<li class="col02"><img src="{{sku.image.url}}"></li>
	<li class="col03">{{sku.name}}<br><em>{{sku.price}}元/{{sku.unite}}</em></li>
	<li class="col04">{{sku.unite}}</li>
	<li class="col05">{{sku.price}}元</li>
	<li class="col06">
		<div class="num_add">
			<a href="javascript:;" class="add fl">+</a>
			<input type="text" class="num_show fl" value="{{sku.count}}">
			<a href="javascript:;" class="minus fl">-</a>
		</div>
	</li>
	<li class="col07">{{sku.amount}}元</li>
	<li class="col08"><a href="javascript:;">删除</a></li>
</ul>
{% endfor %}


<ul class="settlements">
	<li class="col01"><input type="checkbox" name="" checked=""></li>
	<li class="col02">全选</li>
	<li class="col03">合计(不含运费)：<span>¥</span><em>{{total_price}}</em><br>共计<b>{{total_count}}</b>件商品</li>
	<li class="col04"><a href="place_order.html">去结算</a></li>
</ul>
<script>
	function update_page_info(){
		total_count=0
		total_price=0
		$('.cart_list_td').find(':checked').parents('ul').each(function(){
			count=$(this).find('.num_show').val()
			amount=$(this).children('.col07').text()
			count=parseInt(count)
			amount=parseInt(amount)
			total_count+=count
			total_price+=amount
		})
		$('.settlements').find('em').text(total_price.toFixed(2))
		$('.settlements').find('b').text(total_count)
		$('.total_count').find('em').text(total_count)
	}

	$('.settlements').find(':checkbox').change(function() {
		is_checked = $(this).prop('checked')
		$('.cart_list_td').find(':checkbox').each(function () {
			$(this).prop('checked', is_checked)
		})
		update_page_info()
	})

	$('.cart_list_td').find(':checkbox').change(function(){
		all_len=$('.cart_list_td').length
		checked_len=$('.cart_list_td').find(':checked').length
		if(checked_len<all_len){
			$('.settlements').find(':checkbox').prop('checked',false)
		}else{
			$('.settlements').find(':checkbox').prop('checked',true)
		}
		update_page_info()
	})
</script>
{% endblock body %}